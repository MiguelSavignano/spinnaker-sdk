#! /usr/bin/env node
const express = require('express')
const fs = require('fs')
const { GitubAuth } = require('../src/auth/GitubAuth')

const app = express()
const { PORT = 8085 } = process.env

const gitubAuth = new GitubAuth({
  clientId: process.env.CLIENT_ID,
  secretId: process.env.SECRET_ID,
  redirectUrl: `http://localhost:${PORT}/callback`
})

app.get('/callback', async (req, res) => {
  const data = await gitubAuth.authorize(req.query.code)
  res.send(data)
  fs.writeFileSync('token.json', JSON.stringify(data, null, 2))
  console.log("Generated token.json")
  process.exit(0)
})

app.listen(PORT)

const authUrl = gitubAuth.authorizeUrl()

console.log("Github authorization url:\n")
console.log(authUrl)
